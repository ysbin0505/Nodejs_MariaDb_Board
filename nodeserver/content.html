<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시물 내용</title>
    <style>
     
    </style>
</head>
<body>
  <h1>게시물 내용</h1>
  <div class="post-content" id="post-content">
    <p><strong>번호:</strong> <span id="post-num"></span></p>
    <p><strong>제목:</strong> <span id="post-title"></span></p>
    <p><strong>내용:</strong> <span id="post-content-text"></span></p>
    <p><strong>작성자:</strong> <span id="post-writer"></span></p>
    <p><strong>날짜:</strong> <span id="post-date"></span></p>
  </div>

  <div style="display: flex; justify-content: center;">
    <button type="button" class="navyBtn" onclick="location.href = '/index.html'">돌아가기</button>
    <button type="button" class="navyBtn" onclick="deletePost()">삭제</button>
  </div>
  <h2>댓글</h2>
  <div id="comment-container">
    <form id="comment-form">
      <div>
        <label for="comment-writer">작성자:</label>
        <input type="text" id="comment-writer" required>
      </div>
      <div>
        <label for="comment-content">댓글 내용:</label>
        <textarea id="comment-content" required></textarea>
      </div>
      <button type="submit" onclick="submitComment()">등록</button>
    </form>
    <table id="comment-table">
      <tbody id="comment-list"></tbody>
    </table>    
  </div>
  <script>
    const postId = new URLSearchParams(window.location.search).get('id');
    const commentForm = document.getElementById('comment-form');
    const commentWriterInput = document.getElementById('comment-writer');
    const commentContentInput = document.getElementById('comment-content');
    const commentTableBody = document.getElementById('comment-list');
    
    const postId2 = getPostIdFromURL();
    fetchComments(postId2);

    commentForm.addEventListener('submit', (e) => {
      e.preventDefault();
      submitComment();
    });

    function getPostIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }


    function fetchComments(postId2) {
      fetch(`/comments/${postId2}`)
        .then(response => response.json())
        .then(data => {
          const comments = data.comments;
          renderComments(comments);
        })
        .catch(error => console.error('댓글 가져오기 오류:', error));
    }

    function renderComments(comments) {
      commentTableBody.innerHTML = '';

      comments.forEach(comment => {
        const row = commentTableBody.insertRow();
        const writerCell = row.insertCell();
        const contentCell = row.insertCell();

        writerCell.textContent = comment.c_writer;
        contentCell.textContent = comment.c_content;
      });
    }
    

    fetch(`/content/${postId}`)
      .then(response => response.json())
      .then(data => {
        const post = data.post;
        document.getElementById('post-num').textContent = post.num;
        document.getElementById('post-title').textContent = post.title;
        document.getElementById('post-content-text').textContent = post.content;
        document.getElementById('post-writer').textContent = post.writer;
        document.getElementById('post-date').textContent = new Date(post.date).toLocaleDateString();
      })
      .catch(error => {
        console.error('게시물 가져오기 오류:', error);
        // 오류 처리 로직 추가
      });


    // 게시물 삭제 함수
    function deletePost() {
      fetch(`/delete/${postId}`, { method: 'DELETE' })
        .then(response => response.json())
        .then(data => {
          alert('게시물이 삭제되었습니다.');
          window.location.href = '/index.html';
        })
        .catch(error => {
          console.error('게시물 삭제 오류:', error);
          // 오류 처리 로직 추가
        });
    }
  </script>
</body>
</html>